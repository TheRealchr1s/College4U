version: '3.9'

networks:
  c4unetwork:
      driver: bridge

services:
  web:
    build: .
    command: gunicorn main:app --timeout 1000 --bind 0.0.0.0:6969
    volumes:
      - ./cllg/data.csv:/usr/src/app/cllg/data.csv:ro
    depends_on:
      - nginxsrv
    networks:
      - c4unetwork
    restart:
      "unless-stopped"
  
  nginxsrv:
    image: nginx
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/crrapi.cf.conf:ro
      - ./crrapi.cf.key:/etc/nginx/ssl/crrapi.cf.key:ro
      - ./crrapi.cf.crt:/etc/nginx/ssl/crrapi.cf.crt:ro
    ports:
      - "7777:443"
    networks:
      - c4unetwork
    restart:
      "unless-stopped"